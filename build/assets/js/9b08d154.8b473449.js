"use strict";(self.webpackChunkai_native_book=self.webpackChunkai_native_book||[]).push([[392],{8063:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"module-1-ros2/chapter-1-3-communication-patterns","title":"Chapter 1.3 - ROS 2 Communication Patterns","description":"Deep dive into topics, services, and actions communication patterns","source":"@site/docs/module-1-ros2/chapter-1-3-communication-patterns.mdx","sourceDirName":"module-1-ros2","slug":"/module-1-ros2/chapter-1-3-communication-patterns","permalink":"/ai_spec_driven_book/docs/module-1-ros2/chapter-1-3-communication-patterns","draft":false,"unlisted":false,"editUrl":"https://github.com/talhabinhussain/ai_spec_driven_book/tree/main/docs/module-1-ros2/chapter-1-3-communication-patterns.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Chapter 1.3 - ROS 2 Communication Patterns","description":"Deep dive into topics, services, and actions communication patterns","sidebar_position":3,"sidebar_label":"Chapter 1.3: Communication Patterns"},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 1.2: First ROS2 Node","permalink":"/ai_spec_driven_book/docs/module-1-ros2/chapter-1-2-first-ros2-node"},"next":{"title":"Chapter 1.4: Message Types","permalink":"/ai_spec_driven_book/docs/module-1-ros2/chapter-1-4-message-types"}}');var r=s(4848),t=s(8453);const l={title:"Chapter 1.3 - ROS 2 Communication Patterns",description:"Deep dive into topics, services, and actions communication patterns",sidebar_position:3,sidebar_label:"Chapter 1.3: Communication Patterns"},o="Chapter 1.3: ROS 2 Communication Patterns",c={},a=[{value:"Overview",id:"overview",level:2},{value:"Communication Patterns Overview",id:"communication-patterns-overview",level:2},{value:"Topics: Publish-Subscribe Pattern",id:"topics-publish-subscribe-pattern",level:2},{value:"Understanding Topics",id:"understanding-topics",level:3},{value:"Topic Characteristics",id:"topic-characteristics",level:3},{value:"Topic Implementation Example",id:"topic-implementation-example",level:3},{value:"Publisher Node (<code>publisher_node.py</code>)",id:"publisher-node-publisher_nodepy",level:4},{value:"Subscriber Node (<code>subscriber_node.py</code>)",id:"subscriber-node-subscriber_nodepy",level:4},{value:"Quality of Service (QoS) with Topics",id:"quality-of-service-qos-with-topics",level:3},{value:"Common Topic Use Cases",id:"common-topic-use-cases",level:3},{value:"Services: Request-Response Pattern",id:"services-request-response-pattern",level:2},{value:"Understanding Services",id:"understanding-services",level:3},{value:"Service Characteristics",id:"service-characteristics",level:3},{value:"Service Implementation Example",id:"service-implementation-example",level:3},{value:"Service Server (<code>service_server.py</code>)",id:"service-server-service_serverpy",level:4},{value:"Service Client (<code>service_client.py</code>)",id:"service-client-service_clientpy",level:4},{value:"Async Service Client",id:"async-service-client",level:3},{value:"Common Service Use Cases",id:"common-service-use-cases",level:3},{value:"Actions: Goal-Based Pattern",id:"actions-goal-based-pattern",level:2},{value:"Understanding Actions",id:"understanding-actions",level:3},{value:"Action Characteristics",id:"action-characteristics",level:3},{value:"Action Implementation Example",id:"action-implementation-example",level:3},{value:"Action Server (<code>action_server.py</code>)",id:"action-server-action_serverpy",level:4},{value:"Action Client (<code>action_client.py</code>)",id:"action-client-action_clientpy",level:4},{value:"Action with Cancellation",id:"action-with-cancellation",level:3},{value:"Common Action Use Cases",id:"common-action-use-cases",level:3},{value:"Communication Pattern Selection Guide",id:"communication-pattern-selection-guide",level:2},{value:"When to Use Each Pattern",id:"when-to-use-each-pattern",level:3},{value:"Use Topics When:",id:"use-topics-when",level:4},{value:"Use Services When:",id:"use-services-when",level:4},{value:"Use Actions When:",id:"use-actions-when",level:4},{value:"Pattern Comparison Matrix",id:"pattern-comparison-matrix",level:3},{value:"Advanced Communication Patterns",id:"advanced-communication-patterns",level:2},{value:"1. Publisher-Subscriber with Services",id:"1-publisher-subscriber-with-services",level:3},{value:"2. Multiple Publishers and Subscribers",id:"2-multiple-publishers-and-subscribers",level:3},{value:"3. Conditional Communication",id:"3-conditional-communication",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"1. Topic Performance",id:"1-topic-performance",level:3},{value:"2. Service Performance",id:"2-service-performance",level:3},{value:"3. Action Performance",id:"3-action-performance",level:3},{value:"Error Handling and Robustness",id:"error-handling-and-robustness",level:2},{value:"1. Topic Error Handling",id:"1-topic-error-handling",level:3},{value:"2. Service Error Handling",id:"2-service-error-handling",level:3},{value:"3. Action Error Handling",id:"3-action-error-handling",level:3},{value:"Best Practices Summary",id:"best-practices-summary",level:2},{value:"1. Pattern Selection",id:"1-pattern-selection",level:3},{value:"2. Performance Optimization",id:"2-performance-optimization",level:3},{value:"3. Error Handling",id:"3-error-handling",level:3},{value:"4. Design Principles",id:"4-design-principles",level:3},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2},{value:"Additional Resources",id:"additional-resources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"chapter-13-ros-2-communication-patterns",children:"Chapter 1.3: ROS 2 Communication Patterns"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["In this chapter, you'll explore the three fundamental communication patterns in ROS 2: ",(0,r.jsx)(n.strong,{children:"Topics"}),", ",(0,r.jsx)(n.strong,{children:"Services"}),", and ",(0,r.jsx)(n.strong,{children:"Actions"}),". Each pattern serves specific use cases and understanding when to use each is crucial for effective robotic system design."]}),"\n",(0,r.jsx)(n.p,{children:"By the end of this chapter, you'll understand:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 The differences between topics, services, and actions"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 When to use each communication pattern"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 How to implement each pattern in Python"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Best practices for communication design"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"communication-patterns-overview",children:"Communication Patterns Overview"}),"\n",(0,r.jsx)(n.p,{children:"ROS 2 provides three distinct communication patterns, each optimized for different scenarios:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Pattern"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Use Case"}),(0,r.jsx)(n.th,{children:"Characteristics"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Topics"})}),(0,r.jsx)(n.td,{children:"Publish-Subscribe"}),(0,r.jsx)(n.td,{children:"Continuous data streams"}),(0,r.jsx)(n.td,{children:"Asynchronous, many-to-many"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Services"})}),(0,r.jsx)(n.td,{children:"Request-Response"}),(0,r.jsx)(n.td,{children:"Quick, synchronous operations"}),(0,r.jsx)(n.td,{children:"Synchronous, one-to-one"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Actions"})}),(0,r.jsx)(n.td,{children:"Goal-Based"}),(0,r.jsx)(n.td,{children:"Long-running, cancellable tasks"}),(0,r.jsx)(n.td,{children:"Asynchronous with feedback"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"topics-publish-subscribe-pattern",children:"Topics: Publish-Subscribe Pattern"}),"\n",(0,r.jsx)(n.h3,{id:"understanding-topics",children:"Understanding Topics"}),"\n",(0,r.jsxs)(n.p,{children:["Topics enable ",(0,r.jsx)(n.strong,{children:"asynchronous, many-to-many communication"})," between nodes. Publishers send messages to topics without knowing who (if anyone) is listening. Subscribers receive messages from topics without knowing who published them."]}),"\n",(0,r.jsx)(n.h3,{id:"topic-characteristics",children:"Topic Characteristics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Asynchronous"}),": Publishers don't wait for subscribers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Decoupled"}),": Publishers and subscribers don't know about each other"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Typed"}),": Each topic has a specific message type"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Many-to-Many"}),": Multiple publishers and subscribers per topic"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fire-and-forget"}),": Publishers send messages regardless of subscribers"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"topic-implementation-example",children:"Topic Implementation Example"}),"\n",(0,r.jsx)(n.p,{children:"Let's create a comprehensive topic example with both publisher and subscriber:"}),"\n",(0,r.jsxs)(n.h4,{id:"publisher-node-publisher_nodepy",children:["Publisher Node (",(0,r.jsx)(n.code,{children:"publisher_node.py"}),")"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nTopic publisher example that demonstrates continuous data streaming.\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String, Int32, Float32\nfrom geometry_msgs.msg import Twist\nimport math\nimport time\n\n\nclass TopicPublisherNode(Node):\n    def __init__(self):\n        super().__init__('topic_publisher_node')\n\n        # Create multiple publishers for different data types\n        self.string_publisher = self.create_publisher(String, 'chatter', 10)\n        self.counter_publisher = self.create_publisher(Int32, 'counter', 10)\n        self.sensor_publisher = self.create_publisher(Float32, 'sensor_data', 10)\n        self.cmd_vel_publisher = self.create_publisher(Twist, 'cmd_vel', 10)\n\n        # Timer for publishing messages at 1 Hz\n        self.timer = self.create_timer(1.0, self.publish_messages)\n        self.counter = 0\n\n        self.get_logger().info('Topic Publisher Node initialized!')\n\n    def publish_messages(self):\n        \"\"\"Publish messages to all topics.\"\"\"\n        # Publish string message\n        string_msg = String()\n        string_msg.data = f'Hello World: {self.counter}'\n        self.string_publisher.publish(string_msg)\n\n        # Publish counter\n        counter_msg = Int32()\n        counter_msg.data = self.counter\n        self.counter_publisher.publish(counter_msg)\n\n        # Publish simulated sensor data (sine wave)\n        sensor_msg = Float32()\n        sensor_msg.data = math.sin(self.counter * 0.1) * 10.0\n        self.sensor_publisher.publish(sensor_msg)\n\n        # Publish velocity command\n        cmd_vel_msg = Twist()\n        cmd_vel_msg.linear.x = 0.5  # Move forward at 0.5 m/s\n        cmd_vel_msg.angular.z = 0.1 * math.sin(self.counter * 0.1)  # Gentle turn\n        self.cmd_vel_publisher.publish(cmd_vel_msg)\n\n        self.get_logger().info(f'Published messages: {self.counter}')\n        self.counter += 1\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = TopicPublisherNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info('Node stopped by user')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsxs)(n.h4,{id:"subscriber-node-subscriber_nodepy",children:["Subscriber Node (",(0,r.jsx)(n.code,{children:"subscriber_node.py"}),")"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nTopic subscriber example that demonstrates receiving messages.\n"""\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String, Int32, Float32\nfrom geometry_msgs.msg import Twist\n\n\nclass TopicSubscriberNode(Node):\n    def __init__(self):\n        super().__init__(\'topic_subscriber_node\')\n\n        # Create multiple subscribers\n        self.string_subscription = self.create_subscription(\n            String,\n            \'chatter\',\n            self.string_callback,\n            10)\n\n        self.counter_subscription = self.create_subscription(\n            Int32,\n            \'counter\',\n            self.counter_callback,\n            10)\n\n        self.sensor_subscription = self.create_subscription(\n            Float32,\n            \'sensor_data\',\n            self.sensor_callback,\n            10)\n\n        self.cmd_vel_subscription = self.create_subscription(\n            Twist,\n            \'cmd_vel\',\n            self.cmd_vel_callback,\n            10)\n\n        self.get_logger().info(\'Topic Subscriber Node initialized!\')\n\n    def string_callback(self, msg):\n        """Callback for string messages."""\n        self.get_logger().info(f\'Received string: {msg.data}\')\n\n    def counter_callback(self, msg):\n        """Callback for counter messages."""\n        self.get_logger().info(f\'Received counter: {msg.data}\')\n\n    def sensor_callback(self, msg):\n        """Callback for sensor data."""\n        self.get_logger().info(f\'Received sensor: {msg.data:.2f}\')\n\n    def cmd_vel_callback(self, msg):\n        """Callback for velocity commands."""\n        self.get_logger().info(f\'Received velocity: linear={msg.linear.x:.2f}, angular={msg.angular.z:.2f}\')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = TopicSubscriberNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info(\'Node stopped by user\')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,r.jsx)(n.h3,{id:"quality-of-service-qos-with-topics",children:"Quality of Service (QoS) with Topics"}),"\n",(0,r.jsx)(n.p,{children:"Topics support Quality of Service policies that allow you to tune communication characteristics:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy, DurabilityPolicy\n\n# For sensor data (best effort, keep last 5 messages)\nsensor_qos = QoSProfile(\n    reliability=ReliabilityPolicy.BEST_EFFORT,\n    history=HistoryPolicy.KEEP_LAST,\n    depth=5,\n    durability=DurabilityPolicy.VOLATILE\n)\n\n# For critical commands (reliable, keep last 10 messages)\ncommand_qos = QoSProfile(\n    reliability=ReliabilityPolicy.RELIABLE,\n    history=HistoryPolicy.KEEP_LAST,\n    depth=10,\n    durability=DurabilityPolicy.VOLATILE\n)\n\n# Create publisher with custom QoS\npublisher = self.create_publisher(String, 'topic_name', sensor_qos)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"common-topic-use-cases",children:"Common Topic Use Cases"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Use Case"}),(0,r.jsx)(n.th,{children:"Example Topics"}),(0,r.jsx)(n.th,{children:"Message Types"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Sensor Data"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"/camera/image_raw"}),", ",(0,r.jsx)(n.code,{children:"/lidar/scan"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"sensor_msgs/Image"}),", ",(0,r.jsx)(n.code,{children:"sensor_msgs/LaserScan"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Robot State"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"/joint_states"}),", ",(0,r.jsx)(n.code,{children:"/odom"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"sensor_msgs/JointState"}),", ",(0,r.jsx)(n.code,{children:"nav_msgs/Odometry"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Control Commands"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"/cmd_vel"}),", ",(0,r.jsx)(n.code,{children:"/joint_commands"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"geometry_msgs/Twist"}),", custom messages"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"System Status"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"/robot_status"}),", ",(0,r.jsx)(n.code,{children:"/battery"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"std_msgs/String"}),", ",(0,r.jsx)(n.code,{children:"std_msgs/Float32"})]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"services-request-response-pattern",children:"Services: Request-Response Pattern"}),"\n",(0,r.jsx)(n.h3,{id:"understanding-services",children:"Understanding Services"}),"\n",(0,r.jsxs)(n.p,{children:["Services provide ",(0,r.jsx)(n.strong,{children:"synchronous, one-to-one communication"})," for request-response interactions. The client sends a request and waits for a response from the server."]}),"\n",(0,r.jsx)(n.h3,{id:"service-characteristics",children:"Service Characteristics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Synchronous"}),": Client waits for server response"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"One-to-One"}),": One client communicates with one server"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Request-Response"}),": Client sends request, server sends response"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Quick Operations"}),": Designed for fast operations (< 1 second)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Blocking"}),": Client is blocked until response received"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-implementation-example",children:"Service Implementation Example"}),"\n",(0,r.jsxs)(n.p,{children:["First, create a service definition file. In your package, create a ",(0,r.jsx)(n.code,{children:"srv"})," directory and add ",(0,r.jsx)(n.code,{children:"CalculateDistance.srv"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Request\nfloat64 x1\nfloat64 y1\nfloat64 x2\nfloat64 y2\n---\n# Response\nfloat64 distance\nbool success\nstring message\n"})}),"\n",(0,r.jsxs)(n.h4,{id:"service-server-service_serverpy",children:["Service Server (",(0,r.jsx)(n.code,{children:"service_server.py"}),")"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nService server example that calculates distance between two points.\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import Trigger  # Built-in service\nfrom std_srvs.srv import SetBool  # Built-in service\nimport math\n\n\nclass ServiceServerNode(Node):\n    def __init__(self):\n        super().__init__('service_server_node')\n\n        # Create different types of services\n        self.trigger_service = self.create_service(\n            Trigger,\n            'trigger_operation',\n            self.trigger_callback\n        )\n\n        self.bool_service = self.create_service(\n            SetBool,\n            'set_power_state',\n            self.bool_callback\n        )\n\n        self.get_logger().info('Service Server Node initialized!')\n\n    def trigger_callback(self, request, response):\n        \"\"\"Handle trigger service requests.\"\"\"\n        self.get_logger().info('Trigger service called')\n\n        # Simulate some processing\n        response.success = True\n        response.message = f'Operation completed at {self.get_clock().now().nanoseconds}'\n\n        return response\n\n    def bool_callback(self, request, response):\n        \"\"\"Handle boolean service requests.\"\"\"\n        self.get_logger().info(f'SetBool service called with data: {request.data}')\n\n        response.success = True\n        response.message = f'Power state set to: {request.data}'\n\n        return response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = ServiceServerNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info('Service server stopped by user')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsxs)(n.h4,{id:"service-client-service_clientpy",children:["Service Client (",(0,r.jsx)(n.code,{children:"service_client.py"}),")"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nService client example that calls services.\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import Trigger\nfrom std_srvs.srv import SetBool\nimport sys\n\n\nclass ServiceClientNode(Node):\n    def __init__(self):\n        super().__init__('service_client_node')\n\n        # Create clients for the services\n        self.trigger_client = self.create_client(Trigger, 'trigger_operation')\n        self.bool_client = self.create_client(SetBool, 'set_power_state')\n\n        # Wait for services to be available\n        while not self.trigger_client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Trigger service not available, waiting again...')\n\n        while not self.bool_client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Bool service not available, waiting again...')\n\n        # Call services\n        self.call_trigger_service()\n        self.call_bool_service(True)\n        self.call_bool_service(False)\n\n    def call_trigger_service(self):\n        \"\"\"Call the trigger service.\"\"\"\n        request = Trigger.Request()\n\n        future = self.trigger_client.call_async(request)\n        rclpy.spin_until_future_complete(self, future)\n\n        if future.result() is not None:\n            response = future.result()\n            self.get_logger().info(f'Trigger response: success={response.success}, message={response.message}')\n        else:\n            self.get_logger().error('Trigger service call failed')\n\n    def call_bool_service(self, value):\n        \"\"\"Call the bool service with a specific value.\"\"\"\n        request = SetBool.Request()\n        request.data = value\n\n        future = self.bool_client.call_async(request)\n        rclpy.spin_until_future_complete(self, future)\n\n        if future.result() is not None:\n            response = future.result()\n            self.get_logger().info(f'Bool response: success={response.success}, message={response.message}')\n        else:\n            self.get_logger().error('Bool service call failed')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = ServiceClientNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info('Service client stopped by user')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"async-service-client",children:"Async Service Client"}),"\n",(0,r.jsx)(n.p,{children:"For non-blocking service calls, use async clients:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'class AsyncServiceClientNode(Node):\n    def __init__(self):\n        super().__init__(\'async_service_client_node\')\n        self.client = self.create_client(Trigger, \'trigger_operation\')\n\n        # Wait for service and then call it asynchronously\n        if self.client.wait_for_service(timeout_sec=1.0):\n            self.call_service_async()\n\n    def call_service_async(self):\n        """Call service asynchronously."""\n        request = Trigger.Request()\n        future = self.client.call_async(request)\n        future.add_done_callback(self.service_response_callback)\n\n    def service_response_callback(self, future):\n        """Handle service response."""\n        try:\n            response = future.result()\n            self.get_logger().info(f\'Async response: {response.message}\')\n        except Exception as e:\n            self.get_logger().error(f\'Service call failed: {e}\')\n'})}),"\n",(0,r.jsx)(n.h3,{id:"common-service-use-cases",children:"Common Service Use Cases"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Use Case"}),(0,r.jsx)(n.th,{children:"Example Services"}),(0,r.jsx)(n.th,{children:"Service Types"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Configuration"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"/set_parameters"}),", ",(0,r.jsx)(n.code,{children:"/reset_odometry"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"rcl_interfaces/SetParameters"}),", custom"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"System Control"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"/start_robot"}),", ",(0,r.jsx)(n.code,{children:"/stop_robot"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"std_srvs/SetBool"}),", ",(0,r.jsx)(n.code,{children:"std_srvs/Trigger"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Data Queries"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"/get_robot_state"}),", ",(0,r.jsx)(n.code,{children:"/get_map"})]}),(0,r.jsx)(n.td,{children:"Custom services"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Calibration"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"/calibrate_sensors"}),", ",(0,r.jsx)(n.code,{children:"/home_joints"})]}),(0,r.jsx)(n.td,{children:"Custom services"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"actions-goal-based-pattern",children:"Actions: Goal-Based Pattern"}),"\n",(0,r.jsx)(n.h3,{id:"understanding-actions",children:"Understanding Actions"}),"\n",(0,r.jsxs)(n.p,{children:["Actions are designed for ",(0,r.jsx)(n.strong,{children:"long-running, cancellable tasks"})," that provide feedback during execution. They support goals, feedback, and results with the ability to cancel operations."]}),"\n",(0,r.jsx)(n.h3,{id:"action-characteristics",children:"Action Characteristics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Long-Running"}),": Designed for operations that take more than 1 second"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cancellable"}),": Operations can be cancelled mid-execution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Feedback"}),": Provides progress updates during execution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Goal-Oriented"}),": Client sends a goal, server processes it"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Asynchronous"}),": Non-blocking communication"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"action-implementation-example",children:"Action Implementation Example"}),"\n",(0,r.jsxs)(n.h4,{id:"action-server-action_serverpy",children:["Action Server (",(0,r.jsx)(n.code,{children:"action_server.py"}),")"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nAction server example for navigation tasks.\n\"\"\"\n\nimport rclpy\nfrom rclpy.action import ActionServer, CancelResponse, GoalResponse\nfrom rclpy.node import Node\nfrom rclpy.callback_groups import ReentrantCallbackGroup\nfrom rclpy.executors import MultiThreadedExecutor\n\nfrom nav2_msgs.action import NavigateToPose  # Using standard action\nfrom geometry_msgs.msg import PoseStamped\nimport time\nimport math\n\n\nclass NavigationActionServer(Node):\n    def __init__(self):\n        super().__init__('navigation_action_server')\n\n        # Create action server with reentrant callback group for multiple goals\n        self._action_server = ActionServer(\n            self,\n            NavigateToPose,\n            'navigate_to_pose',\n            execute_callback=self.execute_callback,\n            goal_callback=self.goal_callback,\n            cancel_callback=self.cancel_callback,\n            callback_group=ReentrantCallbackGroup()\n        )\n\n        self.get_logger().info('Navigation Action Server initialized!')\n\n    def goal_callback(self, goal_request):\n        \"\"\"Accept or reject a goal.\"\"\"\n        self.get_logger().info('Received navigation goal request')\n        return GoalResponse.ACCEPT\n\n    def cancel_callback(self, goal_handle):\n        \"\"\"Accept or reject a cancel request.\"\"\"\n        self.get_logger().info('Received cancel request')\n        return CancelResponse.ACCEPT\n\n    async def execute_callback(self, goal_handle):\n        \"\"\"Execute the navigation goal.\"\"\"\n        self.get_logger().info('Executing navigation goal...')\n\n        # Get target pose from goal\n        target_pose = goal_handle.request.pose.pose\n        target_x = target_pose.position.x\n        target_y = target_pose.position.y\n\n        # Simulate navigation with feedback\n        feedback_msg = NavigateToPose.Feedback()\n        result = NavigateToPose.Result()\n\n        # Simulate movement in steps\n        for step in range(10):\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                result.result = None\n                self.get_logger().info('Navigation cancelled')\n                return result\n\n            # Simulate progress\n            progress = (step + 1) / 10.0\n            distance_remaining = math.sqrt(\n                (target_x - (step * 0.1))**2 +\n                (target_y - (step * 0.1))**2\n            )\n\n            # Update feedback\n            feedback_msg.current_pose = PoseStamped()\n            feedback_msg.current_pose.pose.position.x = step * 0.1\n            feedback_msg.current_pose.pose.position.y = step * 0.1\n            feedback_msg.distance_remaining = distance_remaining\n\n            # Publish feedback\n            goal_handle.publish_feedback(feedback_msg)\n            self.get_logger().info(f'Navigation progress: {progress:.2%}, distance: {distance_remaining:.2f}')\n\n            # Simulate time delay\n            time.sleep(0.5)\n\n        # Complete the goal\n        if not goal_handle.is_cancel_requested:\n            goal_handle.succeed()\n            result.result = PoseStamped()\n            result.result.pose = target_pose\n            self.get_logger().info('Navigation completed successfully')\n        else:\n            goal_handle.canceled()\n            result.result = None\n            self.get_logger().info('Navigation was cancelled')\n\n        return result\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = NavigationActionServer()\n\n    # Use multi-threaded executor to handle multiple goals\n    executor = MultiThreadedExecutor()\n    executor.add_node(node)\n\n    try:\n        executor.spin()\n    except KeyboardInterrupt:\n        node.get_logger().info('Action server stopped by user')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsxs)(n.h4,{id:"action-client-action_clientpy",children:["Action Client (",(0,r.jsx)(n.code,{children:"action_client.py"}),")"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nAction client example for navigation tasks.\n"""\n\nimport rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\n\nfrom nav2_msgs.action import NavigateToPose\nfrom geometry_msgs.msg import Pose, Point, Quaternion\n\n\nclass NavigationActionClient(Node):\n    def __init__(self):\n        super().__init__(\'navigation_action_client\')\n\n        # Create action client\n        self._action_client = ActionClient(\n            self,\n            NavigateToPose,\n            \'navigate_to_pose\'\n        )\n\n    def send_goal(self, x, y, z=0.0):\n        """Send a navigation goal."""\n        # Wait for action server\n        self._action_client.wait_for_server()\n\n        # Create goal message\n        goal_msg = NavigateToPose.Goal()\n        goal_msg.pose.pose.position.x = x\n        goal_msg.pose.pose.position.y = y\n        goal_msg.pose.pose.position.z = z\n        goal_msg.pose.pose.orientation.w = 1.0  # No rotation\n\n        # Send goal with feedback callback\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback\n        )\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        """Handle goal response."""\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().info(\'Goal rejected\')\n            return\n\n        self.get_logger().info(\'Goal accepted\')\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def feedback_callback(self, feedback_msg):\n        """Handle feedback during execution."""\n        feedback = feedback_msg.feedback\n        self.get_logger().info(\n            f\'Feedback: distance remaining = {feedback.distance_remaining:.2f}\'\n        )\n\n    def get_result_callback(self, future):\n        """Handle the final result."""\n        result = future.result().result\n        self.get_logger().info(f\'Result: {result}\')\n        rclpy.shutdown()\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    action_client = NavigationActionClient()\n\n    # Send a navigation goal\n    action_client.send_goal(2.0, 2.0)  # Navigate to (2.0, 2.0)\n\n    try:\n        rclpy.spin(action_client)\n    except KeyboardInterrupt:\n        action_client.get_logger().info(\'Action client stopped by user\')\n    finally:\n        action_client.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,r.jsx)(n.h3,{id:"action-with-cancellation",children:"Action with Cancellation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'class CancellableActionClient(Node):\n    def __init__(self):\n        super().__init__(\'cancellable_action_client\')\n        self._action_client = ActionClient(self, NavigateToPose, \'navigate_to_pose\')\n\n    def send_and_cancel_goal(self):\n        """Send a goal and then cancel it."""\n        self._action_client.wait_for_server()\n\n        goal_msg = NavigateToPose.Goal()\n        goal_msg.pose.pose.position.x = 10.0\n        goal_msg.pose.pose.position.y = 10.0\n        goal_msg.pose.pose.orientation.w = 1.0\n\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback\n        )\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n        # Schedule cancellation after 2 seconds\n        self.create_timer(2.0, self.cancel_goal)\n\n    def cancel_goal(self):\n        """Cancel the current goal."""\n        if hasattr(self, \'_goal_handle\') and self._goal_handle is not None:\n            self._goal_handle.cancel_goal_async()\n\n    def goal_response_callback(self, future):\n        """Handle goal response."""\n        goal_handle = future.result()\n        if goal_handle.accepted:\n            self._goal_handle = goal_handle\n            self._get_result_future = goal_handle.get_result_async()\n            self._get_result_future.add_done_callback(self.get_result_callback)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"common-action-use-cases",children:"Common Action Use Cases"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Use Case"}),(0,r.jsx)(n.th,{children:"Example Actions"}),(0,r.jsx)(n.th,{children:"Action Types"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Navigation"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"/navigate_to_pose"}),", ",(0,r.jsx)(n.code,{children:"/follow_path"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"nav2_msgs/NavigateToPose"}),", ",(0,r.jsx)(n.code,{children:"nav_msgs/FollowPath"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Manipulation"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"/move_group"}),", ",(0,r.jsx)(n.code,{children:"/gripper_command"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"moveit_msgs/MoveGroup"}),", custom"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Calibration"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"/calibrate_camera"}),", ",(0,r.jsx)(n.code,{children:"/laser_scan"})]}),(0,r.jsx)(n.td,{children:"Custom actions"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Long Operations"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"/mapping"}),", ",(0,r.jsx)(n.code,{children:"/recording"})]}),(0,r.jsx)(n.td,{children:"Custom actions"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"communication-pattern-selection-guide",children:"Communication Pattern Selection Guide"}),"\n",(0,r.jsx)(n.h3,{id:"when-to-use-each-pattern",children:"When to Use Each Pattern"}),"\n",(0,r.jsx)(n.h4,{id:"use-topics-when",children:"Use Topics When:"}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Continuous Data Streaming"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Sensor data (cameras, LiDAR, IMU)"}),"\n",(0,r.jsx)(n.li,{children:"Robot state (joint positions, odometry)"}),"\n",(0,r.jsx)(n.li,{children:"System status updates"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Many-to-Many Communication"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Multiple nodes need the same data"}),"\n",(0,r.jsx)(n.li,{children:"Decoupled system design"}),"\n",(0,r.jsx)(n.li,{children:"Fire-and-forget scenarios"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Real-time Requirements"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Low latency needed"}),"\n",(0,r.jsx)(n.li,{children:"High-frequency updates"}),"\n",(0,r.jsx)(n.li,{children:"Best-effort delivery acceptable"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"use-services-when",children:"Use Services When:"}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Quick Operations"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Operations that complete in < 1 second"}),"\n",(0,r.jsx)(n.li,{children:"Configuration changes"}),"\n",(0,r.jsx)(n.li,{children:"System queries"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Request-Response Pattern"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Need immediate response"}),"\n",(0,r.jsx)(n.li,{children:"One-off calculations"}),"\n",(0,r.jsx)(n.li,{children:"Synchronous operations"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Simple Interactions"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Enable/disable features"}),"\n",(0,r.jsx)(n.li,{children:"Trigger events"}),"\n",(0,r.jsx)(n.li,{children:"Simple queries"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"use-actions-when",children:"Use Actions When:"}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Long-Running Tasks"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Operations that take > 1 second"}),"\n",(0,r.jsx)(n.li,{children:"Navigation to distant locations"}),"\n",(0,r.jsx)(n.li,{children:"Complex manipulations"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Progress Feedback Needed"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Want to monitor progress"}),"\n",(0,r.jsx)(n.li,{children:"Need intermediate results"}),"\n",(0,r.jsx)(n.li,{children:"Want to show completion percentage"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Cancellable Operations"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"User might want to stop"}),"\n",(0,r.jsx)(n.li,{children:"Task might need interruption"}),"\n",(0,r.jsx)(n.li,{children:"Resource conflicts possible"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"pattern-comparison-matrix",children:"Pattern Comparison Matrix"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Aspect"}),(0,r.jsx)(n.th,{children:"Topics"}),(0,r.jsx)(n.th,{children:"Services"}),(0,r.jsx)(n.th,{children:"Actions"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Latency"})}),(0,r.jsx)(n.td,{children:"Very Low"}),(0,r.jsx)(n.td,{children:"Low"}),(0,r.jsx)(n.td,{children:"Medium"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Complexity"})}),(0,r.jsx)(n.td,{children:"Simple"}),(0,r.jsx)(n.td,{children:"Simple"}),(0,r.jsx)(n.td,{children:"Complex"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Feedback"})}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Yes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Cancellation"})}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Yes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Sync/Async"})}),(0,r.jsx)(n.td,{children:"Async"}),(0,r.jsx)(n.td,{children:"Sync"}),(0,r.jsx)(n.td,{children:"Async"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Use Case"})}),(0,r.jsx)(n.td,{children:"Streaming"}),(0,r.jsx)(n.td,{children:"Queries"}),(0,r.jsx)(n.td,{children:"Long Tasks"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"advanced-communication-patterns",children:"Advanced Communication Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"1-publisher-subscriber-with-services",children:"1. Publisher-Subscriber with Services"}),"\n",(0,r.jsx)(n.p,{children:"Combine patterns for complete functionality:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'class HybridNode(Node):\n    def __init__(self):\n        super().__init__(\'hybrid_node\')\n\n        # Publisher for continuous data\n        self.data_publisher = self.create_publisher(String, \'sensor_data\', 10)\n\n        # Subscriber for commands\n        self.command_subscription = self.create_subscription(\n            String, \'commands\', self.command_callback, 10\n        )\n\n        # Service for configuration\n        self.config_service = self.create_service(\n            SetBool, \'configure_sensor\', self.config_callback\n        )\n\n        # Timer for continuous publishing\n        self.timer = self.create_timer(0.1, self.publish_data)\n\n    def publish_data(self):\n        """Publish continuous sensor data."""\n        msg = String()\n        msg.data = f\'Sensor reading: {self.get_clock().now().nanoseconds}\'\n        self.data_publisher.publish(msg)\n\n    def command_callback(self, msg):\n        """Handle incoming commands."""\n        self.get_logger().info(f\'Received command: {msg.data}\')\n\n    def config_callback(self, request, response):\n        """Handle configuration requests."""\n        self.get_logger().info(f\'Config request: {request.data}\')\n        response.success = True\n        response.message = \'Configuration updated\'\n        return response\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2-multiple-publishers-and-subscribers",children:"2. Multiple Publishers and Subscribers"}),"\n",(0,r.jsx)(n.p,{children:"Handle multiple data streams:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class MultiStreamNode(Node):\n    def __init__(self):\n        super().__init__('multi_stream_node')\n\n        # Multiple publishers\n        self.pub1 = self.create_publisher(String, 'stream1', 10)\n        self.pub2 = self.create_publisher(Int32, 'stream2', 10)\n        self.pub3 = self.create_publisher(Float32, 'stream3', 10)\n\n        # Multiple subscribers\n        self.sub1 = self.create_subscription(String, 'input1', self.callback1, 10)\n        self.sub2 = self.create_subscription(Int32, 'input2', self.callback2, 10)\n        self.sub3 = self.create_subscription(Float32, 'input3', self.callback3, 10)\n\n    def callback1(self, msg):\n        self.get_logger().info(f'Stream 1: {msg.data}')\n\n    def callback2(self, msg):\n        self.get_logger().info(f'Stream 2: {msg.data}')\n\n    def callback3(self, msg):\n        self.get_logger().info(f'Stream 3: {msg.data}')\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-conditional-communication",children:"3. Conditional Communication"}),"\n",(0,r.jsx)(n.p,{children:"Switch between patterns based on context:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class AdaptiveNode(Node):\n    def __init__(self):\n        super().__init__('adaptive_node')\n\n        # Both publisher and service client\n        self.status_publisher = self.create_publisher(String, 'status', 10)\n        self.health_service = self.create_client(Trigger, 'health_check')\n\n        self.timer = self.create_timer(1.0, self.adaptive_communication)\n        self.use_service = False  # Toggle between patterns\n\n    def adaptive_communication(self):\n        \"\"\"Switch communication pattern based on conditions.\"\"\"\n        if self.use_service and self.health_service.service_is_ready():\n            # Use service for critical check\n            request = Trigger.Request()\n            future = self.health_service.call_async(request)\n            future.add_done_callback(self.health_response_callback)\n        else:\n            # Use topic for regular updates\n            msg = String()\n            msg.data = f'Regular status update: {self.get_clock().now().nanoseconds}'\n            self.status_publisher.publish(msg)\n\n    def health_response_callback(self, future):\n        \"\"\"Handle health check response.\"\"\"\n        try:\n            response = future.result()\n            self.get_logger().info(f'Health check: {response.message}')\n        except Exception as e:\n            self.get_logger().error(f'Health check failed: {e}')\n"})}),"\n",(0,r.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,r.jsx)(n.h3,{id:"1-topic-performance",children:"1. Topic Performance"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# Optimize for high-frequency topics\nhigh_freq_qos = QoSProfile(\n    reliability=ReliabilityPolicy.BEST_EFFORT,\n    history=HistoryPolicy.KEEP_LAST,\n    depth=1,  # Keep only latest message\n    durability=DurabilityPolicy.VOLATILE\n)\n\n# Optimize for critical topics\ncritical_qos = QoSProfile(\n    reliability=ReliabilityPolicy.RELIABLE,\n    history=HistoryPolicy.KEEP_ALL,\n    depth=100,  # Keep many messages\n    durability=DurabilityPolicy.TRANSIENT_LOCAL\n)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-service-performance",children:"2. Service Performance"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class OptimizedServiceNode(Node):\n    def __init__(self):\n        super().__init__('optimized_service_node')\n\n        # Use callback groups for parallel service handling\n        self.callback_group = ReentrantCallbackGroup()\n\n        self.service = self.create_service(\n            SetBool,\n            'fast_service',\n            self.fast_callback,\n            callback_group=self.callback_group\n        )\n\n    def fast_callback(self, request, response):\n        \"\"\"Optimized service callback.\"\"\"\n        # Minimize processing time\n        response.success = True\n        response.message = 'Fast response'\n        return response\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-action-performance",children:"3. Action Performance"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'class OptimizedActionServer(Node):\n    def __init__(self):\n        super().__init__(\'optimized_action_server\')\n\n        # Use appropriate callback group\n        self.action_server = ActionServer(\n            self,\n            NavigateToPose,\n            \'optimized_navigate\',\n            execute_callback=self.execute_callback,\n            callback_group=ReentrantCallbackGroup()  # Allow concurrent goals\n        )\n\n    async def execute_callback(self, goal_handle):\n        """Optimized action execution."""\n        # Process efficiently\n        result = NavigateToPose.Result()\n\n        # Perform navigation with optimized feedback frequency\n        for i in range(0, 100, 10):  # Feedback every 10%\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                result.result = None\n                return result\n\n            # Publish feedback less frequently\n            if i % 20 == 0:  # Every 20%\n                feedback_msg = NavigateToPose.Feedback()\n                feedback_msg.distance_remaining = 100 - i\n                goal_handle.publish_feedback(feedback_msg)\n\n            time.sleep(0.1)  # Simulated work\n\n        goal_handle.succeed()\n        result.result = PoseStamped()  # Success result\n        return result\n'})}),"\n",(0,r.jsx)(n.h2,{id:"error-handling-and-robustness",children:"Error Handling and Robustness"}),"\n",(0,r.jsx)(n.h3,{id:"1-topic-error-handling",children:"1. Topic Error Handling"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class RobustTopicNode(Node):\n    def __init__(self):\n        super().__init__('robust_topic_node')\n        self.publisher = self.create_publisher(String, 'robust_topic', 10)\n        self.subscription = self.create_subscription(\n            String, 'input_topic', self.robust_callback, 10\n        )\n        self.timer = self.create_timer(1.0, self.robust_publish)\n\n    def robust_callback(self, msg):\n        \"\"\"Robust message handling.\"\"\"\n        try:\n            # Validate message content\n            if not msg.data:\n                self.get_logger().warn('Received empty message')\n                return\n\n            # Process message\n            self.get_logger().info(f'Processed: {msg.data}')\n\n        except Exception as e:\n            self.get_logger().error(f'Error processing message: {e}')\n\n    def robust_publish(self):\n        \"\"\"Robust message publishing.\"\"\"\n        try:\n            msg = String()\n            msg.data = f'Robust message: {self.get_clock().now().nanoseconds}'\n            self.publisher.publish(msg)\n        except Exception as e:\n            self.get_logger().error(f'Error publishing message: {e}')\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-service-error-handling",children:"2. Service Error Handling"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class RobustServiceNode(Node):\n    def __init__(self):\n        super().__init__('robust_service_node')\n        self.service = self.create_service(\n            SetBool, 'robust_service', self.robust_service_callback\n        )\n\n    def robust_service_callback(self, request, response):\n        \"\"\"Robust service callback with error handling.\"\"\"\n        try:\n            # Validate request\n            if request.data is None:\n                response.success = False\n                response.message = 'Invalid request: data is None'\n                return response\n\n            # Process request\n            response.success = True\n            response.message = f'Processed: {request.data}'\n\n        except Exception as e:\n            response.success = False\n            response.message = f'Service error: {str(e)}'\n            self.get_logger().error(f'Service error: {e}')\n\n        return response\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-action-error-handling",children:"3. Action Error Handling"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class RobustActionServer(Node):\n    def __init__(self):\n        super().__init__('robust_action_server')\n        self.action_server = ActionServer(\n            self,\n            NavigateToPose,\n            'robust_navigate',\n            execute_callback=self.robust_execute_callback,\n            goal_callback=self.goal_callback\n        )\n\n    def goal_callback(self, goal_request):\n        \"\"\"Validate goal before accepting.\"\"\"\n        try:\n            # Check if goal is valid\n            target = goal_request.pose.pose.position\n            if math.isnan(target.x) or math.isnan(target.y):\n                self.get_logger().warn('Invalid goal coordinates')\n                return GoalResponse.REJECT\n\n            return GoalResponse.ACCEPT\n        except Exception as e:\n            self.get_logger().error(f'Goal validation error: {e}')\n            return GoalResponse.REJECT\n\n    async def robust_execute_callback(self, goal_handle):\n        \"\"\"Robust action execution.\"\"\"\n        result = NavigateToPose.Result()\n\n        try:\n            target = goal_handle.request.pose.pose.position\n\n            # Simulate navigation\n            for step in range(10):\n                if goal_handle.is_cancel_requested:\n                    goal_handle.canceled()\n                    result.result = None\n                    return result\n\n                # Check for execution errors\n                if step == 5:  # Simulate obstacle detection\n                    goal_handle.abort()\n                    result.result = None\n                    self.get_logger().warn('Obstacle detected, aborting navigation')\n                    return result\n\n                # Publish feedback\n                feedback_msg = NavigateToPose.Feedback()\n                feedback_msg.distance_remaining = 10 - step\n                goal_handle.publish_feedback(feedback_msg)\n\n                time.sleep(0.2)\n\n            # Complete successfully\n            goal_handle.succeed()\n            result.result = PoseStamped()\n            result.result.pose = goal_handle.request.pose.pose\n\n        except Exception as e:\n            self.get_logger().error(f'Action execution error: {e}')\n            goal_handle.abort()\n            result.result = None\n\n        return result\n"})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices-summary",children:"Best Practices Summary"}),"\n",(0,r.jsx)(n.h3,{id:"1-pattern-selection",children:"1. Pattern Selection"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Choose the right pattern for your use case"}),"\n",(0,r.jsx)(n.li,{children:"Consider latency, feedback, and cancellation needs"}),"\n",(0,r.jsx)(n.li,{children:"Don't force one pattern when another is more appropriate"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-performance-optimization",children:"2. Performance Optimization"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use appropriate QoS settings for topics"}),"\n",(0,r.jsx)(n.li,{children:"Keep service calls fast and simple"}),"\n",(0,r.jsx)(n.li,{children:"Provide meaningful feedback for actions"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-error-handling",children:"3. Error Handling"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Always validate inputs and handle exceptions"}),"\n",(0,r.jsx)(n.li,{children:"Use appropriate logging levels"}),"\n",(0,r.jsx)(n.li,{children:"Implement graceful degradation"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-design-principles",children:"4. Design Principles"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Keep nodes focused on single responsibilities"}),"\n",(0,r.jsx)(n.li,{children:"Use descriptive names for topics, services, and actions"}),"\n",(0,r.jsx)(n.li,{children:"Document message types and expected behavior"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"In this chapter, you learned:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 The three fundamental ROS 2 communication patterns: Topics, Services, and Actions"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 When to use each pattern based on use case requirements"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 How to implement each pattern with proper error handling"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Best practices for communication design and performance optimization"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 How to combine patterns for complex system designs"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsx)(n.p,{children:"Now that you understand ROS 2 communication patterns, you're ready to learn about message types and data structures!"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Continue to:"})," ",(0,r.jsx)(n.a,{href:"chapter-1-4-message-types",children:"Chapter 1.4: ROS 2 Message Types and Data Structures \u2192"})]}),"\n",(0,r.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/About-Topics.html",children:"ROS 2 Communication Patterns Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Client-Libraries.html",children:"ROS 2 Services Tutorial"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Intermediate/Actions.html",children:"ROS 2 Actions Tutorial"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/About-Quality-of-Service-Settings.html",children:"Quality of Service in ROS 2"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var i=s(6540);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);