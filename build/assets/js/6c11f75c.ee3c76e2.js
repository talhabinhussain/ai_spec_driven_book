"use strict";(self.webpackChunkai_native_book=self.webpackChunkai_native_book||[]).push([[982],{6157:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"module-1-ros2/chapter-1-2-first-ros2-node","title":"Chapter 1.2 - Building Your First ROS 2 Node","description":"Create and run your first ROS 2 node with Python and rclpy","source":"@site/docs/module-1-ros2/chapter-1-2-first-ros2-node.mdx","sourceDirName":"module-1-ros2","slug":"/module-1-ros2/chapter-1-2-first-ros2-node","permalink":"/ai_spec_driven_book/docs/module-1-ros2/chapter-1-2-first-ros2-node","draft":false,"unlisted":false,"editUrl":"https://github.com/talhabinhussain/ai_spec_driven_book/tree/main/docs/module-1-ros2/chapter-1-2-first-ros2-node.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Chapter 1.2 - Building Your First ROS 2 Node","description":"Create and run your first ROS 2 node with Python and rclpy","sidebar_position":2,"sidebar_label":"Chapter 1.2: First ROS2 Node"},"sidebar":"tutorialSidebar","previous":{"title":"Module Overview","permalink":"/ai_spec_driven_book/docs/module-1-ros2/"},"next":{"title":"Chapter 1.3: Communication Patterns","permalink":"/ai_spec_driven_book/docs/module-1-ros2/chapter-1-3-communication-patterns"}}');var i=s(4848),t=s(8453);const o={title:"Chapter 1.2 - Building Your First ROS 2 Node",description:"Create and run your first ROS 2 node with Python and rclpy",sidebar_position:2,sidebar_label:"Chapter 1.2: First ROS2 Node"},a="Chapter 1.2: Building Your First ROS 2 Node",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setting Up Your Workspace",id:"setting-up-your-workspace",level:2},{value:"Creating a ROS 2 Workspace",id:"creating-a-ros-2-workspace",level:3},{value:"Creating Your First Package",id:"creating-your-first-package",level:3},{value:"Understanding the Package Structure",id:"understanding-the-package-structure",level:2},{value:"Python Package Directory",id:"python-package-directory",level:3},{value:"Package Manifest (package.xml)",id:"package-manifest-packagexml",level:3},{value:"Setup Configuration",id:"setup-configuration",level:3},{value:"Creating Your First Node",id:"creating-your-first-node",level:2},{value:"Creating the Node File",id:"creating-the-node-file",level:3},{value:"Adding the Executable Permission",id:"adding-the-executable-permission",level:3},{value:"Building Your Package",id:"building-your-package",level:2},{value:"Running Your First Node",id:"running-your-first-node",level:2},{value:"Running the Node Directly",id:"running-the-node-directly",level:3},{value:"Verifying the Node is Running",id:"verifying-the-node-is-running",level:3},{value:"Listening to the Topic",id:"listening-to-the-topic",level:3},{value:"Enhanced Node with Subscriptions",id:"enhanced-node-with-subscriptions",level:2},{value:"Running Multiple Nodes",id:"running-multiple-nodes",level:2},{value:"Terminal 1 - Start the Two-Way Node:",id:"terminal-1---start-the-two-way-node",level:3},{value:"Terminal 2 - Start a Simple Publisher to Send Messages:",id:"terminal-2---start-a-simple-publisher-to-send-messages",level:3},{value:"Terminal 3 - Listen to Outgoing Messages:",id:"terminal-3---listen-to-outgoing-messages",level:3},{value:"Understanding Node Structure",id:"understanding-node-structure",level:2},{value:"Key Components of a ROS 2 Node",id:"key-components-of-a-ros-2-node",level:3},{value:"Node Naming and Uniqueness",id:"node-naming-and-uniqueness",level:3},{value:"Common Node Patterns",id:"common-node-patterns",level:2},{value:"1. Publisher-Only Node",id:"1-publisher-only-node",level:3},{value:"2. Subscriber-Only Node",id:"2-subscriber-only-node",level:3},{value:"3. Publisher-Subscriber Node",id:"3-publisher-subscriber-node",level:3},{value:"Error Handling and Best Practices",id:"error-handling-and-best-practices",level:2},{value:"1. Proper Resource Management",id:"1-proper-resource-management",level:3},{value:"2. Parameter Configuration",id:"2-parameter-configuration",level:3},{value:"3. Shutdown Handling",id:"3-shutdown-handling",level:3},{value:"Testing Your Node",id:"testing-your-node",level:2},{value:"1. Using Command-Line Tools",id:"1-using-command-line-tools",level:3},{value:"2. Unit Testing",id:"2-unit-testing",level:3},{value:"Debugging Techniques",id:"debugging-techniques",level:2},{value:"1. Logging Levels",id:"1-logging-levels",level:3},{value:"2. Using rqt Tools",id:"2-using-rqt-tools",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"1. QoS Profile Optimization",id:"1-qos-profile-optimization",level:3},{value:"2. Memory Management",id:"2-memory-management",level:3},{value:"Complete Example: Temperature Monitor Node",id:"complete-example-temperature-monitor-node",level:2},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2},{value:"Additional Resources",id:"additional-resources",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"chapter-12-building-your-first-ros-2-node",children:"Chapter 1.2: Building Your First ROS 2 Node"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["In this chapter, you'll build your first ROS 2 node using Python and the ",(0,i.jsx)(n.code,{children:"rclpy"})," client library. This hands-on experience will solidify your understanding of ROS 2 architecture by creating a simple publisher node that broadcasts messages to other nodes in the system."]}),"\n",(0,i.jsx)(n.p,{children:"By the end of this chapter, you'll understand:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 How to create a basic ROS 2 Python package"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 The structure of a ROS 2 node with publishers"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 How to run and test your first node"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Best practices for node development"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"Before starting, ensure you have:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ROS 2 Humble Hawksbill"})," installed (or your preferred ROS 2 distribution)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Python 3.8+"})," environment"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Basic Python programming"})," knowledge"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Terminal/command line"})," familiarity"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"setting-up-your-workspace",children:"Setting Up Your Workspace"}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-ros-2-workspace",children:"Creating a ROS 2 Workspace"}),"\n",(0,i.jsx)(n.p,{children:"First, create a new workspace for your ROS 2 packages:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Create workspace directory\nmkdir -p ~/ros2_ws/src\ncd ~/ros2_ws\n\n# Source ROS 2 environment\nsource /opt/ros/humble/setup.bash  # Replace 'humble' with your distribution\n\n# Build the workspace (even though it's empty)\ncolcon build\nsource install/setup.bash\n"})}),"\n",(0,i.jsx)(n.h3,{id:"creating-your-first-package",children:"Creating Your First Package"}),"\n",(0,i.jsxs)(n.p,{children:["Create a new ROS 2 package called ",(0,i.jsx)(n.code,{children:"my_robot_pkg"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src\nros2 pkg create --build-type ament_python my_robot_pkg\n"})}),"\n",(0,i.jsx)(n.p,{children:"This creates a basic package structure. Navigate to the package directory:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd my_robot_pkg\nls -la\n"})}),"\n",(0,i.jsx)(n.p,{children:"You should see this structure:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"my_robot_pkg/\n\u251c\u2500\u2500 my_robot_pkg/           # Python package directory\n\u251c\u2500\u2500 resource/              # Resource marker file\n\u251c\u2500\u2500 test/                  # Test directory\n\u251c\u2500\u2500 package.xml           # Package manifest\n\u251c\u2500\u2500 setup.cfg             # Python setup configuration\n\u251c\u2500\u2500 setup.py              # Python package setup\n\u2514\u2500\u2500 README.md             # Documentation file\n"})}),"\n",(0,i.jsx)(n.h2,{id:"understanding-the-package-structure",children:"Understanding the Package Structure"}),"\n",(0,i.jsx)(n.h3,{id:"python-package-directory",children:"Python Package Directory"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"my_robot_pkg/my_robot_pkg/"})," directory contains your Python modules. This is where you'll add your node code:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"my_robot_pkg/my_robot_pkg/\n\u251c\u2500\u2500 __init__.py           # Makes it a Python package\n\u2514\u2500\u2500 my_first_node.py      # Your first ROS 2 node\n"})}),"\n",(0,i.jsx)(n.h3,{id:"package-manifest-packagexml",children:"Package Manifest (package.xml)"}),"\n",(0,i.jsx)(n.p,{children:"This XML file describes your package and its dependencies:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\n<package format="3">\n  <name>my_robot_pkg</name>\n  <version>0.0.0</version>\n  <description>First ROS 2 Python package</description>\n  <maintainer email="you@example.com">Your Name</maintainer>\n  <license>Apache-2.0</license>\n\n  <depend>rclpy</depend>\n  <depend>std_msgs</depend>\n\n  <test_depend>ament_copyright</test_depend>\n  <test_depend>ament_flake8</test_depend>\n  <test_depend>ament_pep257</test_depend>\n  <test_depend>python3-pytest</test_depend>\n\n  <export>\n    <build_type>ament_python</build_type>\n  </export>\n</package>\n'})}),"\n",(0,i.jsx)(n.h3,{id:"setup-configuration",children:"Setup Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"setup.py"})," file defines how your package should be built:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from setuptools import find_packages, setup\n\npackage_name = 'my_robot_pkg'\n\nsetup(\n    name=package_name,\n    version='0.0.0',\n    packages=find_packages(exclude=['test']),\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='Your Name',\n    maintainer_email='you@example.com',\n    description='First ROS 2 Python package',\n    license='Apache-2.0',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'my_first_node = my_robot_pkg.my_first_node:main',\n        ],\n    },\n)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"creating-your-first-node",children:"Creating Your First Node"}),"\n",(0,i.jsx)(n.h3,{id:"creating-the-node-file",children:"Creating the Node File"}),"\n",(0,i.jsxs)(n.p,{children:["Create your first node file in ",(0,i.jsx)(n.code,{children:"my_robot_pkg/my_robot_pkg/my_first_node.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nSimple publisher node that broadcasts messages.\nThis node demonstrates the basic structure of a ROS 2 Python node.\n"""\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\n\nclass MyFirstNode(Node):\n    """\n    A simple publisher node that sends messages to a topic.\n    """\n\n    def __init__(self):\n        # Initialize the node with the name \'my_first_node\'\n        super().__init__(\'my_first_node\')\n\n        # Create a publisher for String messages on the \'my_topic\' topic\n        self.publisher_ = self.create_publisher(String, \'my_topic\', 10)\n\n        # Create a timer to publish messages every 0.5 seconds (2 Hz)\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n\n        # Counter to track published messages\n        self.i = 0\n\n        # Log a startup message\n        self.get_logger().info(\'MyFirstNode initialized and ready to publish!\')\n\n    def timer_callback(self):\n        """Callback function called by the timer to publish messages."""\n        # Create a String message\n        msg = String()\n        msg.data = f\'Hello World: {self.i}\'\n\n        # Publish the message\n        self.publisher_.publish(msg)\n\n        # Log the published message\n        self.get_logger().info(f\'Publishing: "{msg.data}"\')\n\n        # Increment the counter\n        self.i += 1\n\n\ndef main(args=None):\n    """Main function to run the node."""\n    # Initialize the ROS 2 Python client library\n    rclpy.init(args=args)\n\n    # Create an instance of the node\n    my_first_node = MyFirstNode()\n\n    try:\n        # Start spinning to process callbacks\n        rclpy.spin(my_first_node)\n    except KeyboardInterrupt:\n        # Handle Ctrl+C gracefully\n        pass\n    finally:\n        # Clean up\n        my_first_node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"adding-the-executable-permission",children:"Adding the Executable Permission"}),"\n",(0,i.jsx)(n.p,{children:"Make your node file executable:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"chmod +x my_robot_pkg/my_robot_pkg/my_first_node.py\n"})}),"\n",(0,i.jsx)(n.h2,{id:"building-your-package",children:"Building Your Package"}),"\n",(0,i.jsx)(n.p,{children:"Before running your node, you need to build your package:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select my_robot_pkg\nsource install/setup.bash\n"})}),"\n",(0,i.jsx)(n.h2,{id:"running-your-first-node",children:"Running Your First Node"}),"\n",(0,i.jsx)(n.h3,{id:"running-the-node-directly",children:"Running the Node Directly"}),"\n",(0,i.jsx)(n.p,{children:"Start your node:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run my_robot_pkg my_first_node\n"})}),"\n",(0,i.jsx)(n.p,{children:"You should see output like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'[INFO] [1699123456.789012]: MyFirstNode initialized and ready to publish!\n[INFO] [1699123457.289012]: Publishing: "Hello World: 0"\n[INFO] [1699123457.789012]: Publishing: "Hello World: 1"\n[INFO] [1699123458.289012]: Publishing: "Hello World: 2"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"verifying-the-node-is-running",children:"Verifying the Node is Running"}),"\n",(0,i.jsx)(n.p,{children:"Open a new terminal and check that your node is running:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# List running nodes\nros2 node list\n\n# You should see:\n# /my_first_node\n\n# List topics\nros2 topic list\n\n# You should see:\n# /my_topic\n# /parameter_events\n# /rosout\n\n# Check topic info\nros2 topic info /my_topic\n\n# You should see:\n# Type: std_msgs/msg/String\n# Publisher count: 1\n# Subscription count: 0\n"})}),"\n",(0,i.jsx)(n.h3,{id:"listening-to-the-topic",children:"Listening to the Topic"}),"\n",(0,i.jsx)(n.p,{children:"In another terminal, listen to the messages being published:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 topic echo /my_topic\n\n# You should see messages like:\n# data: 'Hello World: 0'\n# ---\n# data: 'Hello World: 1'\n# ---\n# data: 'Hello World: 2'\n# ---\n"})}),"\n",(0,i.jsx)(n.h2,{id:"enhanced-node-with-subscriptions",children:"Enhanced Node with Subscriptions"}),"\n",(0,i.jsxs)(n.p,{children:["Now let's create a more sophisticated node that both publishes and subscribes to messages. Create ",(0,i.jsx)(n.code,{children:"my_robot_pkg/my_robot_pkg/two_way_node.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nNode that demonstrates both publishing and subscribing to topics.\nThis shows how nodes can communicate bidirectionally.\n"""\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\n\nclass TwoWayNode(Node):\n    """\n    A node that both publishes and subscribes to topics.\n    """\n\n    def __init__(self):\n        super().__init__(\'two_way_node\')\n\n        # Publisher for outgoing messages\n        self.publisher_ = self.create_publisher(String, \'outgoing_msg\', 10)\n\n        # Subscriber for incoming messages\n        self.subscription = self.create_subscription(\n            String,\n            \'incoming_msg\',\n            self.listener_callback,\n            10)\n        self.subscription  # Prevent unused variable warning\n\n        # Timer for publishing messages\n        timer_period = 1.0  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n\n        self.i = 0\n        self.get_logger().info(\'TwoWayNode initialized with publisher and subscriber!\')\n\n    def timer_callback(self):\n        """Publish outgoing messages."""\n        msg = String()\n        msg.data = f\'Outgoing message #{self.i}\'\n        self.publisher_.publish(msg)\n        self.get_logger().info(f\'Publishing: "{msg.data}"\')\n        self.i += 1\n\n    def listener_callback(self, msg):\n        """Callback for incoming messages."""\n        self.get_logger().info(f\'Received: "{msg.data}"\')\n\n\ndef main(args=None):\n    """Main function to run the two-way node."""\n    rclpy.init(args=args)\n    two_way_node = TwoWayNode()\n\n    try:\n        rclpy.spin(two_way_node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        two_way_node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Update your ",(0,i.jsx)(n.code,{children:"setup.py"})," to add the new entry point:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"entry_points={\n    'console_scripts': [\n        'my_first_node = my_robot_pkg.my_first_node:main',\n        'two_way_node = my_robot_pkg.two_way_node:main',\n    ],\n},\n"})}),"\n",(0,i.jsx)(n.h2,{id:"running-multiple-nodes",children:"Running Multiple Nodes"}),"\n",(0,i.jsx)(n.h3,{id:"terminal-1---start-the-two-way-node",children:"Terminal 1 - Start the Two-Way Node:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\nsource install/setup.bash\nros2 run my_robot_pkg two_way_node\n"})}),"\n",(0,i.jsx)(n.h3,{id:"terminal-2---start-a-simple-publisher-to-send-messages",children:"Terminal 2 - Start a Simple Publisher to Send Messages:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\nsource install/setup.bash\nros2 topic pub /incoming_msg std_msgs/msg/String \"data: 'Hello from external publisher!'\"\n"})}),"\n",(0,i.jsx)(n.h3,{id:"terminal-3---listen-to-outgoing-messages",children:"Terminal 3 - Listen to Outgoing Messages:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\nsource install/setup.bash\nros2 topic echo /outgoing_msg\n"})}),"\n",(0,i.jsx)(n.h2,{id:"understanding-node-structure",children:"Understanding Node Structure"}),"\n",(0,i.jsx)(n.h3,{id:"key-components-of-a-ros-2-node",children:"Key Components of a ROS 2 Node"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String  # Import required message types\n\nclass MyNode(Node):\n    def __init__(self):\n        # 1. Initialize the node with a name\n        super().__init__('node_name')\n\n        # 2. Create publishers, subscribers, services, etc.\n        self.publisher_ = self.create_publisher(String, 'topic_name', 10)\n\n        # 3. Create timers for periodic tasks\n        self.timer = self.create_timer(0.5, self.timer_callback)\n\n        # 4. Log startup information\n        self.get_logger().info('Node initialized!')\n\n    def timer_callback(self):\n        # 5. Callback function for timer\n        msg = String()\n        msg.data = 'Message content'\n        self.publisher_.publish(msg)\n\ndef main(args=None):\n    # 6. Main function that initializes and runs the node\n    rclpy.init(args=args)\n    node = MyNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"node-naming-and-uniqueness",children:"Node Naming and Uniqueness"}),"\n",(0,i.jsx)(n.p,{children:"ROS 2 ensures node names are unique. If you try to run multiple nodes with the same name, the second one will fail:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Terminal 1\nros2 run my_robot_pkg my_first_node\n\n# Terminal 2 - This will cause a name collision\nros2 run my_robot_pkg my_first_node  # Will fail with name collision error\n"})}),"\n",(0,i.jsx)(n.p,{children:"To run multiple instances, use unique names:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Terminal 1\nros2 run my_robot_pkg my_first_node --ros-args --remap __node:=node_instance_1\n\n# Terminal 2 - This works now\nros2 run my_robot_pkg my_first_node --ros-args --remap __node:=node_instance_2\n"})}),"\n",(0,i.jsx)(n.h2,{id:"common-node-patterns",children:"Common Node Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"1-publisher-only-node",children:"1. Publisher-Only Node"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class SensorNode(Node):\n    def __init__(self):\n        super().__init__('sensor_node')\n        self.publisher_ = self.create_publisher(String, 'sensor_data', 10)\n        self.timer = self.create_timer(0.1, self.publish_sensor_data)\n\n    def publish_sensor_data(self):\n        # Simulate reading sensor data\n        msg = String()\n        msg.data = f'Sensor reading: {self.get_clock().now().nanoseconds}'\n        self.publisher_.publish(msg)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-subscriber-only-node",children:"2. Subscriber-Only Node"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class DataProcessorNode(Node):\n    def __init__(self):\n        super().__init__('data_processor_node')\n        self.subscription = self.create_subscription(\n            String,\n            'sensor_data',\n            self.process_data,\n            10)\n\n    def process_data(self, msg):\n        # Process incoming data\n        self.get_logger().info(f'Processing: {msg.data}')\n        # Add your processing logic here\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-publisher-subscriber-node",children:"3. Publisher-Subscriber Node"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class RelayNode(Node):\n    def __init__(self):\n        super().__init__('relay_node')\n        self.publisher_ = self.create_publisher(String, 'processed_data', 10)\n        self.subscription = self.create_subscription(\n            String,\n            'raw_data',\n            self.process_and_relay,\n            10)\n\n    def process_and_relay(self, msg):\n        # Process and relay the message\n        processed_msg = String()\n        processed_msg.data = f'Processed: {msg.data}'\n        self.publisher_.publish(processed_msg)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"error-handling-and-best-practices",children:"Error Handling and Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"1-proper-resource-management",children:"1. Proper Resource Management"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class RobustNode(Node):\n    def __init__(self):\n        super().__init__('robust_node')\n        self.publisher_ = self.create_publisher(String, 'topic', 10)\n        self.timer = self.create_timer(0.5, self.timer_callback)\n        self.running = True\n\n    def timer_callback(self):\n        if self.running:\n            try:\n                msg = String()\n                msg.data = 'Safe message'\n                self.publisher_.publish(msg)\n            except Exception as e:\n                self.get_logger().error(f'Error in timer callback: {e}')\n\n    def stop_node(self):\n        self.running = False\n        self.destroy_timer(self.timer)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-parameter-configuration",children:"2. Parameter Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class ConfigurableNode(Node):\n    def __init__(self):\n        super().__init__('configurable_node')\n\n        # Declare parameters with default values\n        self.declare_parameter('publish_rate', 2.0)\n        self.declare_parameter('topic_name', 'my_topic')\n\n        # Get parameter values\n        publish_rate = self.get_parameter('publish_rate').value\n        topic_name = self.get_parameter('topic_name').value\n\n        self.publisher_ = self.create_publisher(String, topic_name, 10)\n        self.timer = self.create_timer(1.0/publish_rate, self.timer_callback)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-shutdown-handling",children:"3. Shutdown Handling"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def main(args=None):\n    rclpy.init(args=args)\n    node = MyNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info('Node interrupted by user')\n    except Exception as e:\n        node.get_logger().error(f'Unexpected error: {e}')\n    finally:\n        # Always clean up resources\n        node.destroy_node()\n        rclpy.shutdown()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"testing-your-node",children:"Testing Your Node"}),"\n",(0,i.jsx)(n.h3,{id:"1-using-command-line-tools",children:"1. Using Command-Line Tools"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check node status\nros2 run my_robot_pkg my_first_node\n\n# In another terminal, check what the node is doing\nros2 node info /my_first_node\n\n# Output shows publishers, subscribers, services, etc.\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-unit-testing",children:"2. Unit Testing"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"test/test_my_first_node.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import unittest\nimport rclpy\nfrom my_robot_pkg.my_first_node import MyFirstNode\n\n\nclass TestMyFirstNode(unittest.TestCase):\n    def setUp(self):\n        rclpy.init()\n        self.node = MyFirstNode()\n\n    def tearDown(self):\n        self.node.destroy_node()\n        rclpy.shutdown()\n\n    def test_node_creation(self):\n        """Test that the node was created successfully."""\n        self.assertEqual(self.node.get_name(), \'my_first_node\')\n\n    def test_publisher_exists(self):\n        """Test that the publisher was created."""\n        self.assertIsNotNone(self.node.publisher_)\n\n\nif __name__ == \'__main__\':\n    unittest.main()\n'})}),"\n",(0,i.jsx)(n.h2,{id:"debugging-techniques",children:"Debugging Techniques"}),"\n",(0,i.jsx)(n.h3,{id:"1-logging-levels",children:"1. Logging Levels"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Different logging levels\nself.get_logger().debug('Debug information')\nself.get_logger().info('General information')\nself.get_logger().warn('Warning message')\nself.get_logger().error('Error message')\nself.get_logger().fatal('Fatal error')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-using-rqt-tools",children:"2. Using rqt Tools"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Install rqt if not already installed\nsudo apt install ros-humble-rqt ros-humble-rqt-graph\n\n# Launch rqt\nrqt\n\n# Use rqt_graph to visualize the node graph\nros2 run rqt_graph rqt_graph\n"})}),"\n",(0,i.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,i.jsx)(n.h3,{id:"1-qos-profile-optimization",children:"1. QoS Profile Optimization"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy\n\n# For sensor data (high frequency, best effort)\nsensor_qos = QoSProfile(\n    reliability=ReliabilityPolicy.BEST_EFFORT,\n    history=HistoryPolicy.KEEP_LAST,\n    depth=5\n)\n\n# For critical commands (reliable delivery)\ncommand_qos = QoSProfile(\n    reliability=ReliabilityPolicy.RELIABLE,\n    history=HistoryPolicy.KEEP_LAST,\n    depth=10\n)\n\nself.publisher_ = self.create_publisher(String, 'topic', sensor_qos)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-memory-management",children:"2. Memory Management"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class EfficientNode(Node):\n    def __init__(self):\n        super().__init__('efficient_node')\n        self.publisher_ = self.create_publisher(String, 'topic', 10)\n\n        # Pre-allocate message objects to avoid garbage collection\n        self.msg = String()\n\n    def timer_callback(self):\n        # Reuse the same message object\n        self.msg.data = f'Message: {self.get_clock().now().nanoseconds}'\n        self.publisher_.publish(self.msg)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"complete-example-temperature-monitor-node",children:"Complete Example: Temperature Monitor Node"}),"\n",(0,i.jsx)(n.p,{children:"Let's create a more realistic example that simulates a temperature sensor node:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nTemperature monitoring node that simulates a temperature sensor.\nDemonstrates real-world node patterns with error handling.\n\"\"\"\n\nimport random\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String, Float32\n\n\nclass TemperatureMonitorNode(Node):\n    def __init__(self):\n        super().__init__('temperature_monitor_node')\n\n        # Publisher for temperature readings\n        self.temp_publisher_ = self.create_publisher(Float32, 'temperature', 10)\n\n        # Publisher for temperature alerts\n        self.alert_publisher_ = self.create_publisher(String, 'temperature_alert', 10)\n\n        # Timer for periodic temperature readings\n        timer_period = 2.0  # seconds\n        self.timer = self.create_timer(timer_period, self.read_temperature)\n\n        # Temperature thresholds\n        self.high_temp_threshold = 30.0\n        self.low_temp_threshold = 10.0\n\n        # Initialize temperature\n        self.current_temp = 20.0\n\n        self.get_logger().info('Temperature Monitor Node initialized!')\n\n    def read_temperature(self):\n        \"\"\"Simulate reading temperature from a sensor.\"\"\"\n        # Simulate temperature reading with some randomness\n        self.current_temp += random.uniform(-1.0, 1.0)\n\n        # Create and publish temperature message\n        temp_msg = Float32()\n        temp_msg.data = round(self.current_temp, 2)\n        self.temp_publisher_.publish(temp_msg)\n\n        self.get_logger().info(f'Temperature: {temp_msg.data}\xb0C')\n\n        # Check for temperature alerts\n        if temp_msg.data > self.high_temp_threshold:\n            alert_msg = String()\n            alert_msg.data = f'HIGH TEMP ALERT: {temp_msg.data}\xb0C (threshold: {self.high_temp_threshold}\xb0C)'\n            self.alert_publisher_.publish(alert_msg)\n            self.get_logger().warn(alert_msg.data)\n        elif temp_msg.data < self.low_temp_threshold:\n            alert_msg = String()\n            alert_msg.data = f'LOW TEMP ALERT: {temp_msg.data}\xb0C (threshold: {self.low_temp_threshold}\xb0C)'\n            self.alert_publisher_.publish(alert_msg)\n            self.get_logger().warn(alert_msg.data)\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    temp_node = TemperatureMonitorNode()\n\n    try:\n        rclpy.spin(temp_node)\n    except KeyboardInterrupt:\n        temp_node.get_logger().info('Temperature monitor stopped by user')\n    finally:\n        temp_node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Add this to your ",(0,i.jsx)(n.code,{children:"setup.py"})," entry points:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"entry_points={\n    'console_scripts': [\n        'my_first_node = my_robot_pkg.my_first_node:main',\n        'two_way_node = my_robot_pkg.two_way_node:main',\n        'temp_monitor = my_robot_pkg.temperature_monitor_node:main',\n    ],\n},\n"})}),"\n",(0,i.jsx)(n.p,{children:"Build and run the temperature monitor:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select my_robot_pkg\nsource install/setup.bash\n\n# Terminal 1: Run the temperature monitor\nros2 run my_robot_pkg temp_monitor\n\n# Terminal 2: Listen to temperature readings\nros2 topic echo /temperature\n\n# Terminal 3: Listen to temperature alerts\nros2 topic echo /temperature_alert\n"})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"In this chapter, you learned:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 How to create a ROS 2 workspace and Python package"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 The structure of a basic ROS 2 node with publishers"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 How to create nodes that both publish and subscribe"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Best practices for node development and error handling"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 How to test and debug your nodes"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Performance optimization techniques"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsx)(n.p,{children:"Now that you understand how to create basic ROS 2 nodes, you're ready to explore more advanced communication patterns!"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Continue to:"})," ",(0,i.jsx)(n.a,{href:"chapter-1-3-communication-patterns",children:"Chapter 1.3: ROS 2 Communication Patterns \u2192"})]}),"\n",(0,i.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/p/rclpy/",children:"ROS 2 Python Client Library (rclpy) Documentation"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html",children:"ROS 2 Package Creation Tutorial"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html",children:"ROS 2 Node and Topic Tutorial"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);